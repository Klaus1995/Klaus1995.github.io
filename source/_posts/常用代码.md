---
title: 常用代码
date: 2017-03-21 16:32:31
tags: Javascript
categories: Javascript
---

# 兼容各浏览器的事件监听组件

```javascript
EventUtil={
	addListener:function(target,type,handler){
	if(target.addEventListener){
	    target.addEventListener(type,handler);
	}else if(target.attachEvent){
	    target.attach("on"+type,function(){
	          handler.call(target);  //让handler中的this指向目标元素
	    });
	}else{
	    target["on"+type]=handler;
	}
	},
	removeListener:function(target,type,handler){   
	  if(target.removeEventListener){    
	    target.removeEventListener(type,handler);          
	 }else if(target.detachEvent){
	    target.detachEvent("on"+type,handler);
	 }else{
	    target["on"+type]=null;
	 }
	},
	getEvent:function(e){      //获取事件对象
	 var evt=window.event||e;
	 return evt;
	},
	getTarget:function(e){      //获得目标对象
	 var evt=EventUtil.getEvent(e);
	 var target;
	 if(evt.target){ target=evt.target;}
	 else {target=evt.srcElement;}
	 return target;
	},
	stopPropagation:function(e){  //停止冒泡
	 var evt=EventUtil.getEvent(e);
	 if(evt.stopPropagation) {evt.stopPropagation();}
	 else {evt.cancelBubble=true;}
	},
	preventDefault:function(e){   //阻值默认行为的发生
	 var evt=EventUtil.getEvent(e);
	 if(evt.preventDefault){ evt.preventDefault(); }
	 else {e.returnValue=false;}
	}
}
```

# Cookie组件

```javascript
CookieUtil=｛
    addCookie:function(key,value,options){
        var str=key+"="+escape(value);
        if(options.expires){
           var curr=new Date();   //options.expires的单位是小时
           curr.setTime(curr.getTime()+options.expires*3600*1000);
           options.expires=curr.toGMTString();
        }
        for(var k in options){   //有可能指定了cookie的path，cookie的domain
           str+=";"+k+"="+options[k];
        }
        document.cookie=str;
    },
    queryCookie:function(key){
      var cookies=document.cookie;
     //获得浏览器端存储的cookie,格式是key=value;key=value;key=value
      cookies+=";";
      var start=cookies.indexOf(key);
      if(start<=-1){ return null; }  //说明不存在该cookie
      var end=cookies.indexOf(";",start);
      var value=cookies.slice(start+key.length+1,end);
      return unescape(value);
    },
    deleteCookie:function(key){
      var value=CookieUtil.queryCookie(key);
      if(value===null){return false;}
      CookieUtil.addCookie(key,value,{expires:0});//把过期时间设置为0，浏览器会马上自动帮我们删除cookie
    }
｝
```

# 对象拷贝

## 浅拷贝

```javascript
var oldObject = {...};
var newObject = Object.assign({},oldObject); //浅拷贝，对象内嵌套的对象不会被拷贝
```

## 深拷贝

```javascript
var oldObject = {...};
function deepCopy (newObj, oldObj) {
	for (key in oldObj) {
		var prop = oldObj[key];
		if (typeof prop === 'object') {
			if (Object.prototype.toString.call(prop) === '[object Array]'){
				newObj[key] = newObj[key] || [];
				deepCopy(newObj[key],prop);
			}else{
				newObj[key] = newObj[key] || {};//如果新对象有定义属性则保留下来
				deepCopy(newObj[key],prop);//递归，向下拷贝
			}
		}else{
			newObj[key] = prop;
		}
	}
	return newObj;
}
var newObject = deepCopy({},oldObject);
```